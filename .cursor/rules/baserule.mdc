---
alwaysApply: true
---

# 基本的なCursorルール

## 1. 技術スタック
- **Python**: できるだけ最新のものを採用
- **uv**: Pythonパッケージマネージャー
- **ruff**: コードフォーマッター
- **pytest**: テストフレームワーク

## 2. プロジェクト構造
```
project/
├── src/
│   ├── README.md
│   └── main.py
├── tests/
│   └── test_main.py
├── docs/
│   ├── flow.md      # mermaidで作成した処理フロー図
│   └── manual.md    # 仕様書
├── pyproject.toml
├── README.md
└── .gitignore
```

## 3. コーディング規約

### 3.1 Pythonコード
- **import文**: 必ずファイルの先頭に記述する
- **型ヒント**: 必ず記述する
  - **`typing`ライブラリは使わず**、`list`, `dict`, `tuple`などの標準機能を使用
  - typing.Optionalは使わず、str | Noneのように記述する
- **docstring**: Googleスタイルを使用
- **言語**: docstring、ログ、コメントは日本語で記述
- **設計**: なるべくクラスを使用
- **分割**: 役割に応じてファイルを分割し、適切にドキュメント化
- **main.py**: 最小限の内容にし、ロジック部分は別ファイルに分離
- **エラーハンドリング**: try-exceptは使用しない。エラーハンドリングも行わない。
- **テスト**: 関数に応じたテストを作成
  - `pytest.raises()`や`pytest.fail()`を積極的に使用する
- **__init__.py**: 不要
- **フォルダ作成**: プログラムでフォルダを作成する場合、src/配下に作成する。
- **ファイル作成**: プログラムでファイルを作成する場合、適切なフォルダを作成し、そこにファイルを作成する
- **print**: 各データに対する処理終了のprintは不要。前処理終了後に総計などの情報をprintする。
- **コメント**: 変更内容のコメントは不要
- **実行時引数**: 基本的に不要。設定値はコードにグローバル変数として記述する。必要な場合はargparseを使用
- **グラフ**: グラフ作成はmatplotlibを使用する。グラフ内のタイトルやラベルは英語のみとし、日本語は使わない。

### 3.2 開発コマンド
```bash
# コードの実行
uv run python path/to/file.py

# コードのフォーマット
uv run ruff format
uv run ruff check path/to/file.py --fix

# テストの実行
uv run pytest
```

## 4. 開発ワークフロー

### 4.1 実行ルール
- **ファイル実行**: 必ず`src/`ディレクトリに移動してから実行する
- **テスト実行**: ルートディレクトリで行う
- **コミット前**: 必ずフォーマットとテストを実行

### 4.2 ドキュメント管理
- **README.md**: 各ディレクトリに設置し、ファイルの役割を記述
- **仕様変更時**: 各階層のREADME.mdおよびdocs/の更新
- **新規ファイル**: 対応するテストコードも作成

### 4.3 環境管理
- **環境変数**: `.env`ファイルで管理し、`.env.example`も提供
- **terraform**: 不要

## 5. 重要な注意事項

### 5.1 必須ルール
- このファイルを読み込んだとき、`"load baserule.mdc"`と出力
- 毎回使用したルールファイルを出力
- ファイルの最後は必ず改行を入れる
- 指示した機能だけを実装してください。後方互換性は不要です。いらなくなったコードは必ず削除してください。

### 5.2 エラーハンドリング
- エラーメッセージは日本語で分かりやすく記述

### 5.3 ファイル操作
- ファイルやフォルダを削除する場合は、**trash**コマンドを使用
- ドキュメント作成で確信が持てない箇所は、出力してユーザーに通知

### 5.4 テストコード
- テストコードを作成する際、エラーが出てもテストコードのロジックを修正することは**絶対にしてはいけない**

### 5.5 MCPの活用
- serenaのMCPが有効になっている場合、積極的に使用する。使用した場合、"use serena"と出力する。仕様できない場合は、"could not use serena"と出力してください。

### 5.6 モック用コード
- testコードを作成する場合を除き、モック用のコードを作成してはならない。
- GCPの認証が必要な場合や、必要なデータが足りないときは、開発を中断してユーザーに通知してください。

### 5.7 不要コードの削除
- 積極的にコードを削除する。
- 仕様を変える際、元の仕様に基づくコードは削除する。
- 後方互換性は不要。

### 5.8 処理の継続
- ルールファイルを読み込んだ後、依頼されたタスクが中断されるときがあります。**依頼されたタスクは必ず行い、中断しないように注意してください。**


## 6. サンプルコードの活用
.cursor/samples/ フォルダにサンプルコードがあります。類似機能を作る場合は参照してください。
参照した場合、"use sample code ({ファイル名})"と出力してください。
- gemini.py (Gemini APIの使用例 (バッチ処理とオンライン処理))
- gcs.py (GCSの使用例)
- slack.py (Slackへの通知例)

## 7. その他ルールファイル
- `.cursor/rules/organization_rule.mdc`を読み込んでください。
  - 読み込んだ後、`"load organization_rule.mdc"`と出力してください。
- プロジェクトルートの`additional_rule.mdc`を読み込んでください。存在しない場合は読み込まなくて構いません。
  - 読み込んだ後、`"load additional_rule.mdc"`と出力してください。
